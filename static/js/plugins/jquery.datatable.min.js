/*!
 * jQuery DataTable Plugin
 * https://github.com/ddbase3/JqueryDataTable
 *
 * Lightweight, extensible data table plugin with paging, sorting, layout slots and modular renderers.
 * Part of the Contourz Photography ecosystem.
 *
 * Author: Daniel Dahme / BASE3 (https://base3.de)
 * License: LGPL (Lesser General Public License)
 */
!function(e){const t={info:function(t,{total:n,page:a,pageSize:r}){const i=(a-1)*r+1,o=Math.min(a*r,n);return e('<div class="jquerydatatable-info"></div>').text(`Records ${i} to ${o} of ${n}`)},pager:function(t,{currentPage:n,pageSize:a,totalPages:r}){const i=t.data("settings"),o=e(document.createDocumentFragment());for(let a=1;a<=r;a++){const r=e('<button type="button"></button>').text(a);a===n&&r.attr("disabled",!0),r.on("click",(function(){i.page=a,t.data("settings",i).trigger("settingsChanged",[i]),s(t)})),o.append(r)}return e('<div class="jquerydatatable-pager"></div>').append(o)},compactPager:function(t,{currentPage:n,pageSize:a,totalPages:r}){const i=t.data("settings"),o=e('<div class="datatable-pager" style="display: inline-flex; align-items: center; gap: 0.5em;"></div>'),l=e('<button type="button">← Prev</button>').prop("disabled",n<=1),c=e('<button type="button">Next →</button>').prop("disabled",n>=r),d=e(`<span>Page ${n} of ${r}</span>`);return l.on("click",(function(){n>1&&(i.page=n-1,t.data("settings",i).trigger("settingsChanged",[i]),s(t))})),c.on("click",(function(){n<r&&(i.page=n+1,t.data("settings",i).trigger("settingsChanged",[i]),s(t))})),o.append(l,d,c),o},pageSizeSelector:function(t){const n=t.data("settings"),a=e('<select class="jquerydatatable-per-page-selector"></select>'),r=n.pageSizeOptions,i=n.pageSize;return r.forEach((t=>{const n=e("<option></option>").val(t).text(`${t} per page`);t===i&&n.prop("selected",!0),a.append(n)})),a.on("change",(function(){n.pageSize=parseInt(e(this).val(),10),n.page=1,t.data("settings",n).trigger("settingsChanged",[n]),s(t)})),e('<div class="jquerydatatable-per-page-container"></div>').append(a)},columnSelector:function(t){const n=t.data("settings"),r=e('<div class="jquerydatatable-column-selector-wrapper" style="position: relative; display: inline-block;"></div>'),i=e('<button type="button" class="column-toggle-btn">Spalten ▾</button>'),o=e('<div class="column-toggle-menu" style="display:none; position:absolute; top:100%; left:0; z-index:1000; background:white; border:1px solid #ccc; padding:10px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);"></div>');function s(e){n.columns.forEach((t=>{t.visible=e})),t.data("settings",n).trigger("settingsChanged",[n]),a(t),o.find('input[type="checkbox"]').not(".all-toggle").prop("checked",e)}const l=e('<div style="white-space:nowrap;"></div>'),c=e('<button type="button">Alle ein</button>').on("click",(function(e){s(!0),e.stopPropagation()})),d=e('<button type="button">Alle aus</button>').on("click",(function(e){s(!1),e.stopPropagation()}));return l.append(c,d),o.append(l,e('<hr style="margin:5px 0;">')),n.columns.forEach((r=>{const i=e('<label style="display:block; margin-bottom: 4px; white-space: nowrap; cursor: pointer;"></label>'),s=e('<input type="checkbox" name="'+r.key+'">').prop("checked",!1!==r.visible).on("change",(function(i){r.visible=e(this).is(":checked"),t.data("settings",n).trigger("settingsChanged",[n]),a(t),i.stopPropagation()}));i.append(s).append(" "+r.label),o.append(i)})),i.on("click",(function(e){e.stopPropagation(),o.toggle()})),e(document).on("click.jquerydatatable.columnselector",(function(){o.hide()})),o.on("click",(function(e){e.stopPropagation()})),r.append(i,o),r},resetButton:function(t){const n=t.data("settings"),r=e('<button type="button" class="jquerydatatable-reset">Reset</button>');return r.on("click",(function(){!function(t){const n=t._initialSettings;t.filters=e.extend(!0,{},n.filters),t.sortColumn=n.sortColumn,t.sortDirection=n.sortDirection,t.pageSize=n.pageSize,t.page=n.page??1,t.columns.forEach(((e,t)=>{e.visible=!1!==n.columns[t]?.visible}))}(n),t.data("settings",n),t.trigger("settingsChanged",[n]),i(t),a(t),o(t,{filter:e=>!n.dynamicRenderers.includes(e)}),s(t)})),e('<div class="jquerydatatable-reset-container"></div>').append(r)},layout:function(t){const n=e('<div class="jquerydatatable-wrapper"></div>'),a=e('<div class="jquerydatatable-header"></div>').append('<div class="left header-left"></div><div class="center header-center"></div><div class="right header-right"></div>'),r=e('<div class="jquerydatatable-footer"></div>').append('<div class="left footer-left"></div><div class="center footer-center"></div><div class="right footer-right"></div>'),i=e('<table class="jquerydatatable-table"><thead></thead><tbody></tbody></table>');return n.append(a,i,r),n},tableHeader:function(t,n,a){const r=e("<thead></thead>"),i=a.renderers.row(null,"header");n.forEach((e=>{const r=a.renderers.cell(null,e,null,"header");if(!r)return;const o=a.renderers.headerCell(e,a);r.append(o),r.on("click",(()=>{const r=a.sortColumn===e.key&&"asc"===a.sortDirection?"desc":"asc";a.sortColumn=e.key,a.sortDirection=r,t.data("settings",a).trigger("settingsChanged",[a]);const i=a.renderers.tableHeader(t,n,a);t.find("thead").replaceWith(i),s(t)})),i.append(r)})),r.append(i);const o=a.renderers.row(null,"filter");return n.forEach((e=>{const n=a.renderers.cell(null,e,null,"filter");if(!n)return;const r=a.renderers.filterCell(e,a,t);n.append(r),o.append(n)})),r.append(o),r},tinyTableHeader:function(t,n,a){const r=e("<thead></thead>"),i=a.renderers.row(null,"header");return n.forEach((e=>{const t=a.renderers.cell(null,e,null,"header");if(!t)return;const n=a.renderers.headerCell(e,a);t.append(n),i.append(t)})),r.append(i),r},headerCell:function(t,n){const a=n.sortColumn===t.key,r=n.sortDirection,i=e("<span></span>").text(t.label).css("white-space","nowrap"),o=e('<span style="margin-left: 4px;"></span>');return a&&o.text("asc"===r?"▲":"▼"),e("<span></span>").append(i,o)},filterCell:function(t,n,a){let r=null;const i=e('<div style="position: relative; width: 100%;"></div>'),o=e('<input type="text" placeholder="Filter..." style="width: 100%; box-sizing: border-box; padding-right: 18px;">'),l=e('<span title="Reset filter" style="position: absolute; right: 6px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #aaa; font-size: 12px;">✖</span>');return o.on("input",(function(){const i=e(this).val();clearTimeout(r),r=setTimeout((()=>{n.filters=n.filters||{},n.filters[t.key]=i,n.page=1,a.data("settings",n).trigger("settingsChanged",[n]),s(a)}),300),l.toggle(!!i)})),l.on("click",(function(){o.val("").trigger("input")})),l.hide(),i.append(o,l),i},filterCellSelect:function(t,n,a){const r=e('<select style="width:100%; box-sizing:border-box;"></select>'),i=t.options||[];return r.append('<option value="">Alle</option>'),i.forEach((e=>{r.append(`<option value="${e.value}">${e.label}</option>`)})),r.on("change",(function(){n.filters=n.filters||{},n.filters[t.key]=e(this).val(),n.page=1,a.data("settings",n).trigger("settingsChanged",[n]),s(a)})),r},valueCell:function(t,n,a){return void 0===a&&n&&n.key&&(a=t[n.key]),e("<span></span>").text(a??"")},cell:function(t,n,a,r){return e("value"===r?"<td></td>":"<th></th>").attr("data-key",n.key).css("cursor","header"===r?"pointer":"default")},row:function(t,n){return e("<tr></tr>")}};t.info.isDynamic=!0,t.pager.isDynamic=!0,t.compactPager.isDynamic=!0;const n={init:function(n){return this.each((function(){const a=e(this),i=e.extend(!0,{dataSource:null,data:null,columns:[],sortColumn:"",sortDirection:"asc",pageSizeOptions:[10,20,50],pageSize:10,page:1,onRowClick:null,layoutTargets:{".footer-right":["pager"],".footer-left":["pageSizeSelector"],".footer-center":["info"],".header-right":["resetButton"],".header-left":["columnSelector"]},renderers:{}},n);i._initialSettings=e.extend(!0,{},i),i.renderers=e.extend({},t,i.renderers);const o=new Set(Object.values(i.layoutTargets).flat());i.dynamicRenderers=[...o].filter((e=>{const t=i.renderers[e];return t&&!0===t.isDynamic})),i.columns=i.columns.map(((e,t)=>(e.key||(e.key="col"+t),void 0===e.visible&&(e.visible=!0),e))),i.filters={},i.page=1,a.data("settings",i),r(a),s(a),a.trigger("settingsChanged",[i])}))},getSettings:function(){return this.data("settings")},updateSettings:function(t){return this.each((function(){const n=e(this),a=n.data("settings")||{},i=e.extend(!0,{},a,t);n.data("settings",i),r(n),s(n),n.trigger("settingsChanged",[i])}))},reload:function(){return this.each((function(){s(e(this))}))}};function a(e){const t=e.data("settings"),n=e.find("table");t.columns.forEach((e=>{const t=e.key;if(!t)return;const a=!1!==e.visible;n.find(`[data-key="${t}"]`).toggle(a)}))}function r(e){const t=e.data("settings"),n=t.renderers.layout(e);e.empty().append(n),i(e),o(e,{filter:e=>!t.dynamicRenderers.includes(e)}),a(e)}function i(e){const t=e.data("settings"),n=t.renderers.tableHeader(e,t.columns,t);e.find("thead").replaceWith(n)}function o(t,n={}){const a=t.data("settings"),{renderData:r={},filter:i=null}=n;Object.entries(a.layoutTargets).forEach((([n,o])=>{const s=t.find(n);s.length&&o.forEach((n=>{if(i&&!i(n))return;const o=a.renderers[n];if("function"!=typeof o)return;const l=o(t,r);if(!(l instanceof e))return;const c=s.find(`[data-renderer="${n}"]`),d=(p=n,u=l,e("<div></div>").attr("data-renderer",p).append(u));var p,u;c.length?c.replaceWith(d):s.append(d)}))}))}function s(t){const n=t.data("settings"),r=n.filters||{},i=n.pageSize,s=n.page,l={sort:n.sortColumn,direction:n.sortDirection,pageSize:i,page:s,filter:r},c=e=>{const r=e.data||e.websites||[],i=t.find("tbody");i.empty(),r.forEach((e=>{const t=n.renderers.row(e,"value");n.columns.forEach((a=>{const r=e[a.key],i=n.renderers.cell(e,a,r,"value");if(!i)return;const o=n.renderers.valueCell(e,a,r);i.append(o),t.append(i)})),"function"==typeof n.onRowClick&&t.css("cursor","pointer").on("click",(()=>n.onRowClick(e))),i.append(t)})),o(t,{renderData:{total:e.total,page:e.page,pageSize:e.pageSize,currentPage:e.page,totalPages:e.totalPages},filter:e=>n.dynamicRenderers.includes(e)}),a(t)};if(Array.isArray(n.data)){const e=function(e,t){return t&&0!==Object.keys(t).length?e.filter((e=>Object.entries(t).every((([t,n])=>(e[t]||"").toString().toLowerCase().includes(n.toLowerCase()))))):e}(n.data,r),t=function(e,t,n){const a=(t-1)*n;return{items:e.slice(a,a+n),totalPages:Math.ceil(e.length/n)}}((d=e,p=n.sortColumn,u=n.sortDirection,p?[...d].sort(((e,t)=>{const n=e[p],a=t[p];return n<a?"asc"===u?-1:1:n>a?"asc"===u?1:-1:0})):d),s,i);c({data:t.items,total:e.length,page:s,pageSize:i,totalPages:t.totalPages})}else"string"==typeof n.dataSource?e.getJSON(n.dataSource,l,(function(e){c(e)})):console.warn("No data or dataSource defined for this datatable.");var d,p,u}e.fn.jqueryDataTable=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jqueryDataTable"):n.init.apply(this,arguments)},e.fn.jqueryDataTable.renderers=t}(jQuery);
